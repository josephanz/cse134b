function habit(a,b,c,d,e,f,g,h,i,j,k,l,m){this.habitId=a,this.habitName=b,this.iconSource=c,this.freqCount=d,this.freqDay=e,this.freqSet=f,this.freqSetMet=g,this.freqBest=h,this.completedDayDate=i,this.updatedFreqDate=j,this.notificationTime=k,this.freqPerWeek=l,this.parseObject=m,console.log("Parse Object = "+m)}function deleteTheHabit(a){console.log("entered the delete");var b=Parse.Object.extend("Habits"),c=new Parse.Query(b);c.get(a,{success:function(a){a.destroy({}),console.log("should have deleted");var b={user:String(Parse.User.current().id)};Parse.Analytics.track("deleteHabit",b)},error:function(a,b){}})}function getHabits(){var a=[],b=Parse.Object.extend("Habits"),c=new Parse.Query(b);c.equalTo("user",Parse.User.current()),c.find({success:function(b){$(".success").show();for(var c=b.length,d=0;c>d;d++){var e=b[d],f=new habit(e.id,e.get("habitName"),e.get("icon").url(),e.get("freqCount"),e.get("freqDay"),e.get("freqSet"),e.get("freqSetMet"),e.get("freqBest"),e.get("completedDayDate"),e.get("updatedFreqCount"),e.get("notificationTime"),e.get("freqPerWeek"),e);a[d]=f}0==a.length&&(window.location="../src/welcome.html"),displayContent(a),makeNotifications(a)},error:function(a,b){$(".error").show()}})}function displayContent(a){var b=a.length;console.log(a),console.log("here "+b);var c;for(c=0;b>c;c++){valuesConcatenatedID=a[c].habitId;var d="'../src/edit.html?habitId="+a[c].habitId+"'",e="";0==a[c].freqDay&&a[c].freqSet>a[c].freqCount&&(e='<button type="button" id="'+a[c].habitId+'-checkButton" class="op op-done" onclick="showMsg(this);" title="done">                        <img src="../img/done.svg" alt="Done">                    </button>'),document.getElementById("habit-list").innerHTML+='             <li>                 <ul class="habit-info">                    <li><div class="habit-name">'+a[c].habitName+'</div></li>                    <li><img class="habit-icon" src="'+a[c].iconSource+'" alt="habit icon"></li>                </ul>                <strong id="'+a[c].habitId+'-completedDayDate" style="visibility: hidden;">'+a[c].completedDayDate+'</strong>                <strong id="'+a[c].habitId+'-updatedFreqDate" style="visibility: hidden;">'+a[c].updatedFreqDate+'</strong>                <div class="message" id='+valuesConcatenatedID+'>                    <span class="message-total">                        <strong id="'+a[c].habitId+'-freqDay" style="visibility: hidden;">'+a[c].freqDay+'</strong>                        <strong id="'+a[c].habitId+'-freqSetMet">'+a[c].freqSetMet+'</strong> days in a row! Best Record: <strong id="'+a[c].habitId+'-freqBest">'+a[c].freqBest+'</strong><br>                        <progress id="'+a[c].habitId+'-progress" value="'+a[c].freqCount+'" max="'+a[c].freqSet+'"></progress>                    </span><br><br>                    <span class="message-today">Completed <strong id="'+a[c].habitId+'-freqCount">'+a[c].freqCount+'</strong>/<strong id="'+a[c].habitId+'-freqSet">'+a[c].freqSet+'</strong> for today!</span>                </div>                <div class="habit-op">                  <button type="button" id="'+a[c].habitId+'-checkButton" class="op op-done" onclick="showMsg(this);" title="done">                        <img src="../img/done.svg" alt="Done">                    </button>                    <button type="button" class="op op-edit" onclick="location.href='+d+'" title="edit habit">                        <img src="../img/edit.svg" alt="Edit">                    </button>                    <button type="button" class="op op-del" onclick="deleteHabit(this);" title="delete habit">                        <img src="../img/delete.svg" alt="Del">                    </button>                </div>            </li>'}}function removeHTMLElement(a){return(elem=document.getElementById(a)).parentNode.removeChild(elem)}function updateFreq(a){var b,c,d=a,e=parseInt(document.getElementById(d+"-freqSetMet").innerHTML),f=parseInt(document.getElementById(d+"-freqBest").innerHTML),g=parseInt(document.getElementById(d+"-freqCount").innerHTML),h=parseInt(document.getElementById(d+"-freqSet").innerHTML),i=parseInt(document.getElementById(d+"-freqDay").innerHTML),j=document.getElementById(d+"-updatedFreqDate").innerHTML,k=document.getElementById(d+"-completedDayDate").innerHTML,l=[],m=(new Date).toString(),n=m.split(" ");if(m=n[1]+n[2]+n[3],console.log("currentDate = "+m),"undefined"!=j){console.log("This one");var n=j.split(" ");console.log(n),c=n[1]+n[2]+n[3],console.log(c)}if("undefined"!=k){console.log("NO this one");var n=k.split(" ");console.log(n),b=n[1]+n[2]+n[3],console.log(b)}if("undefined"!=m&&"undefined"!=b&&m!=b&&m!=c){console.log("holla at yo homeboy"),l=[],g=0,document.getElementById(d+"-freqCount").innerHTML=g,l.push({key:"freqCount",val:g}),i=0,document.getElementById(d+"-freqDay").innerHTML=i,l.push({key:"freqDay",val:i});var o=new Date;l.push({key:"updatedFreqDate",val:o}),document.getElementById(d+"-updatedFreqDate").innerHTML=o.toString(),updateById(d,l)}if(0==i){if(l=[],h>g&&(g+=1,console.log("entered updated count"+g),document.getElementById(d+"-freqCount").innerHTML=g,document.getElementById(d+"-progress").value=g,l.push({key:"freqCount",val:g}),g==h)){var o=new Date;l.push({key:"completedDayDate",val:o}),removeHTMLElement(d+"-checkButton"),i=1,document.getElementById(d+"-freqDay").innerHTML=i,l.push({key:"freqDay",val:i}),e+=1,document.getElementById(d+"-freqSetMet").innerHTML=e,l.push({key:"freqSetMet",val:e}),e>f&&(f=e,document.getElementById(d+"-freqBest").innerHTML=f,l.push({key:"freqBest",val:f}))}updateById(d,l)}}function updateById(a,b){var c=Parse.Object.extend("Habits"),d=new c;d.id=a;var e;console.log(b);for(e in b)d.set(b[e].key,b[e].val),console.log(b[e].key+","+b[e].val);d.save(null,{success:function(a){console.log("updated")},error:function(a,b){}})}function sendNotification(a,b,c){"granted"!==Notification.permission&&Notification.requestPermission();new Notification(a,{body:b,icon:c});try{window.external&&void 0!==window.external.msIsSiteMode()&&(window.external.msIsSiteMode()?createPopUp(a,b,c):createPopUp("Enable Notification","Please pin the site to enable notifications",""))}catch(d){console.log("Site mode is not supported")}}function createPopUp(a,b,c){var d=document.createElement("div");d.innerHTML="<strong>"+a+"</strong><br>"+b,d.className="popup",d.id="popup",d.style.display="none",d.onclick=function(){$(".popup").fadeOut(400);var a=document.getElementById("popup");console.log(a.parentNode),a.parentNode.removeChild(a)},document.body.appendChild(d),$(".popup").fadeIn(400)}function executeAt(a,b,c,d,e){var f=getTimeDiff(a,b,c);-1!=f&&setTimeout(e,f)}function compare(a,b){return a.notificationTime>b.notificationTime?1:-1}function getTimeDiff(a,b,c){var d=(new Date).getDay(),e=(new Date).getHours(),f=(new Date).getMinutes();if(1==c[d]){var g=3600*a*1e3+60*b*1e3,h=3600*e*1e3+60*f*1e3;return h>g?(console.log("Time is in the past"),console.log(a+":"+b),-1):(console.log("Valid time"),console.log(g-h),g-h)}return console.log("Not today"),-1}function makeNotifications(a){console.log("makeNotifications() called"),a.sort(compare);var b,c=a.length,d=0;for(b=0;c>b;b++){var e=a[b].freqPerWeek,f=a[b].notificationTime;if(null!=f){var g=f.split(":"),h=Number(g[0]),i=Number(g[1]),j=a[b].habitId;console.log("time: "+f+" habit: "+a[b].habitName),console.log(a[b].freqPerWeek),console.log(a[b].habitId),executeAt(h,i,e,j,function(){var b=a[d].habitName,c="Have you "+b+" today?",e=a[d].iconSource,f=Parse.Object.extend("Habits"),g=new Parse.Query(f),h=a[d].habitID;g.equalTo("user",Parse.User.current()),console.log("habitId "+a[d].habitId),g.equalTo("objectId",a[d].habitId),d++,g.find({success:function(a){if(console.log("results length "+a.length),0!=a.length){sendNotification(b,c,e);var d={user:String(Parse.User.current().id),habitId:String(h)};Parse.Analytics.track("sendNotification",d)}else console.log("dont send notification")},error:function(a,b){console.log("failed")}})})}}}Parse.initialize("M0a7TBns2wo7HMdoULhac86LMnpjPothTzst4a1T","cV4npfDqaSpeTLSwwyhYxg8CvoWqJc0QjXlM37c0");var fields={visited:Parse.User.current().id};console.log("hi track count +1"),Parse.Analytics.track("habitListPage",fields),getHabits();